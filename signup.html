<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interlinked — Registrati</title>
  <style>
    :root { --gap:12px; }
    * { box-sizing: border-box; margin:0; padding:0; }
    body {
      min-height:100vh; background:#0f172a; color:#e5e7eb;
      display:grid; place-items:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      padding:16px;
    }
    .card {
      width:100%; max-width:420px;
      background:#0b1220; border:1px solid #334155; border-radius:16px;
      padding:22px; box-shadow:0 12px 30px rgba(0,0,0,.35);
      display:flex; flex-direction:column; gap:14px;
    }
    .title { font-weight:900; font-size:1.6rem; text-align:center; margin-bottom:6px; }
    .field { display:flex; flex-direction:column; gap:6px; }
    label { font-size:.9rem; color:#cbd5e1; }
    input {
      width:100%; padding:12px; border-radius:12px; border:1px solid #334155; background:#0b1220; color:#e5e7eb;
    }
    .btn {
      width:100%; padding:12px; border-radius:12px; border:1px solid #334155; background:#0b1220; color:#e5e7eb; cursor:pointer;
      font-weight:700;
    }
    .btn:hover { background:#10192c; }
    .muted { text-align:center; font-size:.9rem; color:#94a3b8; }
    .link { color:#93c5fd; cursor:pointer; }
    .error { color:#fca5a5; font-size:.9rem; min-height:1.2em; }
  </style>
</head>
<body>
  <div class="card">
    <div class="title">Crea Account</div>

    <div class="field">
      <label for="email">E-mail</label>
      <input id="email" type="email" autocomplete="email" />
    </div>
    <div class="field">
      <label for="password">Password</label>
      <input id="password" type="password" autocomplete="new-password" />
    </div>
    <div class="field">
      <label for="username">Username</label>
      <input id="username" type="text" placeholder="Scegli un nome utente" />
    </div>

    <button id="signupBtn" class="btn">Registrati</button>
    <div class="muted">Hai già un account? <a href="login.html" class="link">Accedi</a></div>
    <div id="error" class="error"></div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

  <script>
    firebase.initializeApp({
      apiKey: "AIzaSyAd2Uv9xA36L49YPezEO1QpC6P7t9zHXto",
      authDomain: "interlinked-demo.firebaseapp.com",
      databaseURL: "https://interlinked-demo-default-rtdb.firebaseio.com",
      projectId: "interlinked-demo",
      storageBucket: "interlinked-demo.firebasestorage.app",
      messagingSenderId: "85117709871",
      appId: "1:85117709871:web:a154569112f845e2bfe0da",
      measurementId: "G-RBLX6ZQD01"
    });
    const auth = firebase.auth();
    const db = firebase.database();
    auth.onAuthStateChanged(u => { if (u) location.replace('index.html'); });

    const $ = s => document.querySelector(s);
    const showErr = (m)=> $("#error").textContent = m || "";

    $("#signupBtn").addEventListener("click", async ()=>{
      showErr("");
      const email = $("#email").value.trim();
      const pass  = $("#password").value;
      const uname = $("#username").value.trim();
      if(!email || !pass || !uname) return showErr("Completa tutti i campi.");
      try{
        const cred = await auth.createUserWithEmailAndPassword(email, pass);
        await db.ref("users/"+cred.user.uid+"/profile").set({ email, name: uname });
        location.replace('index.html');
      }catch(e){ showErr(mapErr(e)); }
    });

    function mapErr(e){
      const c = e?.code || "";
      if (c.includes("auth/invalid-email")) return "E-mail non valida.";
      if (c.includes("auth/weak-password")) return "Password troppo debole (min 6).";
      if (c.includes("auth/email-already-in-use")) return "E-mail già registrata.";
      return "Errore: " + (e?.message || e);
    }
  </script>
</body>
</html>
